# Test Profile Configuration for Certificate Authority Backend
# This configuration uses H2 in-memory database for fast, isolated testing

# ===============================================
# Database Configuration (H2 In-Memory)
# ===============================================
spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.h2.console.enabled=false

# ===============================================
# JPA/Hibernate Configuration
# ===============================================
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.H2Dialect
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# ===============================================
# Flyway Configuration (Disabled for Tests)
# ===============================================
spring.flyway.enabled=false

# ===============================================
# Security Configuration
# ===============================================
# Disable security for most tests (enable per test as needed)
spring.security.basic.enabled=false
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration

# ===============================================
# Key Storage Configuration
# ===============================================
app.key-storage.master-password=test-master-password-change-in-production

# ===============================================
# Key Rotation Configuration
# ===============================================
app.key-rotation.default-key-lifetime-days=90
app.key-rotation.usage-threshold=10000
app.key-rotation.overlap-period-hours=24
app.key-rotation.auto-rotation-enabled=false
app.key-rotation.emergency-deactivation-delay-hours=1

# ===============================================
# Security Configuration
# ===============================================
app.security.rate-limit.operations-per-hour=1000
app.security.rate-limit.window-minutes=60
app.security.dual-control.enabled=false
app.security.dual-control.timeout-minutes=30
app.security.suspicious-activity.threshold=100

# ===============================================
# Logging Configuration
# ===============================================
logging.level.com.certificateauthority=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=DEBUG

# ===============================================
# Testing Framework Configuration
# ===============================================
# Disable banner for cleaner test output
spring.main.banner-mode=off

# Use random available port for web tests
server.port=0

# Disable actuator endpoints in tests
management.endpoints.enabled-by-default=false

# ===============================================
# Jackson Configuration
# ===============================================
spring.jackson.time-zone=UTC
spring.jackson.serialization.write-dates-as-timestamps=false
