# Application Configuration
spring.application.name=certificate-authority-backend
server.port=8080

# Database Configuration
spring.datasource.url=jdbc:postgresql://database:5432/certificate_authority
spring.datasource.username=${POSTGRES_USER:postgres}
spring.datasource.password=${POSTGRES_PASSWORD:ca_secure_password_2024}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate Configuration
# IMPORTANT: Use validate in production to prevent schema drift
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.default_schema=public
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false
spring.flyway.ignore-missing-migrations=false

# Jackson Configuration for JSON
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC
spring.jackson.date-format=yyyy-MM-dd'T'HH:mm:ss.SSS'Z'

# Multipart File Upload Configuration
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=100MB
spring.servlet.multipart.enabled=true

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics,flyway
management.endpoint.health.show-details=when-authorized
management.info.env.enabled=true

# Security Configuration (Basic for localhost)
spring.security.user.name=${SECURITY_USERNAME:admin}
spring.security.user.password=${SECURITY_PASSWORD:admin123}
spring.security.user.roles=USER,ADMIN

# Application-specific Configuration
app.keys.storage-path=${KEYS_STORAGE_PATH:/app/keys}
app.max-file-size=${MAX_FILE_SIZE:100MB}
app.supported-image-formats=${SUPPORTED_IMAGE_FORMATS:PNG,JPEG,JPG}
app.default-signing-algorithm=${DEFAULT_SIGNING_ALGORITHM:Ed25519}
app.key-rotation-days=${KEY_ROTATION_DAYS:90}

# Logging Configuration
logging.level.com.certificateauthority=INFO
logging.level.org.springframework.security=DEBUG
logging.level.org.flywaydb=INFO
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# Profile-specific Configuration
spring.profiles.active=${SPRING_PROFILES_ACTIVE:default}

---
# Development Profile
spring:
  config:
    activate:
      on-profile: dev
  jpa:
    show-sql: true
    properties:
      hibernate:
        format_sql: true
  flyway:
    clean-disabled: false
  datasource:
    url: jdbc:postgresql://localhost:5432/certificate_authority

logging:
  level:
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

---
# Docker Profile
spring:
  config:
    activate:
      on-profile: docker
  datasource:
    url: jdbc:postgresql://database:5432/certificate_authority

---
# Test Profile
spring:
  config:
    activate:
      on-profile: test
  jpa:
    hibernate:
      ddl-auto: create-drop
  flyway:
    enabled: false
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
    username: sa
    password: password